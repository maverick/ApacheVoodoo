=head1 BASIC SETUP GUIDE

There are a two  setup steps to begin writing a site with Voodoo.  The following sections
describe those steps.  Some basic understanding of Apache administration is necessary ;)

=head1 Apache Configuration

The first thing we need to do is modify Apache's configuration file to load Voodoo, and to setup our site.

=head2 Example Configuration

  # load these at server start (optional, slightly quicker startup time)
  PerlModule Apache::DBI
  PerlModule Apache::Session
  PerlModule HTML::Template

  # load Apache::Voodoo
  PerlModule Apache::Voodoo::Handler

  # hook in the restart function
  PerlRestartHandler $Apache::Voodoo::Handler->restart

 <Directory /data/sites/test_app/html>
    SetHandler perl-script
    PerlHandler $Apache::Voodoo::Handler->handle
    PerlSetVar ID test_app

    Options Indexes Includes FollowSymLinks
    AllowOverride None

    Order allow,deny
    Allow from all
 </Directory>

The directory block may be repeated as many times as necessary to setup multiple sites.  Directory Aliases 
and Virtual Hosts may also be used in the same manner.

=over 4

=item PerlModule Apache::Voodoo::Handler

Loads Voodoo.  This line must be present somewhere inside the 'main' section of the
apache configuration file...IE. not within a <directory> or <virtual> block.

=item PerlRestartHandler $Apache::Voodoo::Handler->restart

Triggers the initialization of Voodoo on Apache start or restarts.  This let's us use 'graceful' restarts
with apache.  

You need to have mod_perl compiled with support for the Restart Handler.  Some pre-compiled versions of
mod_perl do not include it.  If you get an error about PerlRestartHandler being and invalid directive, 
that's the culprit.

=item SetHandle perl-script

Tells Apache that a mod_perl is going to be use for this directory or virtual host
	
=item PerlHandler $Apache::Voodoo::Handler->handle
	
Tells Apache what method to call to handle requests for this directory

=item PerlSetVar ID name_of_your_app

This let's Voodoo know what application is attached to this directory.  This also corresponds to the name of
the Voodoo configuration file, and base package name (unless overridden) of your application.  

Names matching /[a-z][a-z0-9_-]*/i are valid.

=back

=head1 Voodoo Configuration File

Each Voodoo site has it's own configuration file that is kept in <ServerRoot>/conf/voodoo.
The name of the file is "value of the ID param".conf.  So, for our example above, it would be "test_app.conf".

This is also used as the top level package name that Voodoo will use in loading all other modules.  
This can be overridden with the optional BASE_PACKAGE directive.

Voodoo uses the L<Config/General> module for its configuration files.  See its documentation for more
information on its syntax rules.

=head2 Example Configuration

	cookie_name  = TEST_APP_SID
	session_timeout = 0
	shared_cache    = 0
	session_dir  = /usr/local/apache/sessions/test_app
	debug = 1

	<database>
		connect  = "dbi:mysql:database=test_app;host=127.0.0.1;mysql_connect_timeout=2"
		username = "test_user"
		password = "test_password"
	</database>
	
	<modules>
		login
		admin::login_history
	</modules>

	<includes>
		date
		main_menu
	</includes>

	<template_conf>
		<default>
			skeleton = skeleton.tmpl
			pre_include = date
			post_include = main_menu
		</default>
	</template_conf>

=over 4

=item cookie_name

This is a optional parameter that sets the name of the cookie used by Voodoo for session identification.
If it is not supplied the cookie name will the value of the ID parameter in the config file with "_SID" appended.

=item session_timeout

Number of minutes before a cookie expires.  Set to 0 for no expiration.

=item shared_cache

Whether or not to use Shared memory for caching of templates.  Typically 0 for development
and 1 for production

=item database

This is a list of database connect info.  Databases are connected to in the order listed. 
If the first connection fails the next in the list is used.  An error message is generated 
in the Apache error log file on a failed connection, but no other action is taken.  
There are good database monitoring packages out there :) .  The contents of each array element 
is passed directly to DBI->connect

=item session_dir

This is the directory that Apache::Session will use to store session information.  This directory must be present
and writable by whatever user Apache runs as.

=item debug

Enables or disables the debug() method from Apache::Voodoo. and its associated output on each page.  See L<Apache::Voodoo::Debug> for more information.

=item halt_on_errors

If set to 1, this causes the server to return a 503 (server temporary unavailable) message 
for the host if any modules fail to load.  Defaults to 0

=item modules

This contains the list of page handling modules that will be loaded by Voodoo.

Note that the modules names do not contain the base package name.  "my_app::index" becomes "index", this
saves a bunch of typing, but more importantly prevents accidental cross-site module loading.

=item includes

This contains a list of modules that can be used on a per page basis to inject extra info 
into the output.  For example, if you wish to have the current date and time appear on every page,
create a module that returns that info, include it in this list and add it to the template_conf section
accordingly.

=item template_conf

The entries here are regular expression entries that match one or more page with the site.
Each section may be used to control certain aspects of how Voodoo presents the page.
The magic entry <default> matches any page that doesn't have another matching entry.
Standard items are:

=over 4

=item skeleton

which skeleton template to use

=item pre_include

a list of include modules to call on this page, BEFORE the main page handling module

=item post_include

a list of include modules to call on this page, AFTER the main page handling module

=item content-type

content type for the output.  Defaults to text/html

=back

Any other params will be passed to the template directly, and will be accessible to page handling modules
via $p->{'template_conf'}

=head1 PAGE MODULES

Each page module must inherit from Apache::Voodoo.  This modules provides the new() method to 
make the package a proper object under Voodoo, along with some other minor black magic.  
Inheriting from this module provides access to some essential methods for interacting 
with Voodoo.  See L<Apache::Voodoo>.
